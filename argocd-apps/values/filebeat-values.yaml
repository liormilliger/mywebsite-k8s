daemonset:
  enabled: true
  
  # This section tells Kubernetes how to get the password
  extraEnvs:
    - name: ELASTIC_PASSWORD
      valueFrom:
        secretKeyRef:
          name: elasticsearch-master-credentials
          key: password

  filebeatConfig:
    filebeat.yml: |
      filebeat.autodiscover:
        providers:
          - type: kubernetes
            node: ${NODE_NAME}
            hints.enabled: true
            hints.default_config:
              type: container
              paths:
                - /var/log/containers/*-${data.kubernetes.container.id}.log
      
      processors:
        - add_kubernetes_metadata:
            in_cluster: true

      output.elasticsearch:
        hosts: ["elasticsearch-master.logging.svc:9200"]
        # These lines tell Filebeat to use the credentials
        username: "elastic"
        password: "${ELASTIC_PASSWORD}" # Reads from the environment variable
        
  resources:
    requests:
      cpu: "100m"
      memory: "100Mi"
    limits:
      cpu: "200m"
      memory: "200Mi"